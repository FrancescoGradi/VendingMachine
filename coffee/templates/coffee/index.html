<!doctype html>
<html>
    <head>
        {% load static %}
        <title>Carrello Caff&eacute;</title>
        <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
        <script src="{% static '/coffee/js/shoppingCart.js' %}"></script>

        <!-- Copiato da Ferracane -->
        <meta charset="UTF-8">
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

        <!-- Bootstrap Core CSS -->
        <link href="{% static '/coffee/css/bootstrap.min.css' %}" rel="stylesheet" type="text/css">

        <!-- Custom CSS: You can use this stylesheet to override any Bootstrap styles and/or apply your own styles -->
        <link href="{% static '/coffee/css/custom.css' %}" rel="stylesheet" type="text/css">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
        <!-- Fine Copiato da Ferracane -->

    </head>

    <body background="{% static '/coffee/image/sfondo1.jpg' %}"></body>
    <body>
    <!-- Copiato da Ferracane -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">

                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="{% url 'index' %}">
                    BuyCoffee
                </a>
            </div>

            <!-- Navbar links -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="{% url 'about' %}">About</a>
                    </li>
                    <li>
                        <a href="{% url 'contact' %}">Contact</a>
                    </li>
                </ul>
                <!---<ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#">Contact</a>
                    </li>
                </ul>-->
            </div>
        </div>
    </nav>

    <!-- Fine Copiato da Ferracane -->


        <h1>Ordine Caff&eacute;</h1>
        <div>
            <ul id="list">
                <ul>
                    <a href="#" data-name="CaffÃ© Lavazza" data-price="0.5">Caff&eacute; Lavazza &euro; 0.50</a>
                    <button type="button" id="add-to-cart-coffee"> Aggiungi al Carrello </button>
                </ul>
                <ul>
                    <div>Hai <span id="count-cart">X</span> oggetti nel carrello</div>
                    <div>Totale Carrello:&euro;<span id="total-cart"></span></div>
                    <div>Totale Disponibile: <span id="total-disp"></span></div>
                    <button type="button" id="clear-cart">Svuota Carrello</button>
                    <button type="button" id="payment">Paga</button>
                </ul>
            </ul>
        </div>

        <div class="container-fluid">
            {% load static %}
            {% if coffee_list %}

            <ul class="list-group">
                {% for capsule in coffee_list %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <a class="nounderline" href="{% url 'payment' capsule.coffeeType %}">
                            {{ capsule.coffeeType }}
                        </a> <span class="badge badge-primary badge-pill">{{ capsule.coffeeQuantity }}</span>
                    </li>
                {% endfor %}
            </ul>
            {% else %}
            <ul class="list-group-item-warning">Non ci sono cialde disponibili</ul>
            {% endif %}
        </div>

        <script src="{% static '/coffee/js/shoppingCart.js' %}"></script>

        <script>

            $(".add-to-cart").click(function(event){
                event.preventDefault();
                var name = $(this).attr("data-name");
                var price = Number($(this).attr("data-price"));

                shoppingCart.addItemToCart(name, price, 1);
                displayCart();
            });

            $("#add-to-cart-coffee").click(function (event){
                shoppingCart.addItemToCart(" Lavazza Coffee", 0.5, 1);
                displayCart();
            });

            $("#add-to-cart-coffee2").click(function (event){
                shoppingCart.addItemToCart(" Kimbo Coffee", 0.33, 1);
                displayCart();
            });

            $("#clear-cart").click(function(event){
                shoppingCart.clearCart();
                displayCart();
            });

            $("#payment").click(function(event){
                shoppingCart.paymentOk();
                displayCart();
            });

            function displayCart() {
                var cartArray = shoppingCart.listCart();

                {% load static %}
                {% if coffee_list %}
                    var max = {{ coffee_list.count }};
                {% else %}
                    var max = 0
                {% endif %}

                console.log(cartArray);
                var output = "";

                for (var i in cartArray) {
                    output += "<li>"
                        +cartArray[i].name
                        +" <input class='item-count' type='number' data-name='"
                        +cartArray[i].name
                        +"' value='"+cartArray[i].count+"' >"
                        +" x "+cartArray[i].price
                        +" = "+cartArray[i].total
                        +" <button class='plus-item' data-name='"
                        +cartArray[i].name+"'>+</button>"
                        +" <button class='subtract-item' data-name='"
                        +cartArray[i].name+"'>-</button>"
                        +" <button class='delete-item' data-name='"
                        +cartArray[i].name+"'>X</button>"
                        +"</li>";
                }

                $("#show-cart").html(output);
                $("#count-cart").html( shoppingCart.countCart() );
                $("#total-cart").html( shoppingCart.totalCart() );
                $("#total-disp").html( shoppingCart.getMax());
            }

            $("#show-cart").on("click", ".delete-item", function(event){
                var name = $(this).attr("data-name");
                shoppingCart.removeItemFromCartAll(name);
                displayCart();
            });

            $("#show-cart").on("click", ".subtract-item", function(event){
                var name = $(this).attr("data-name");
                shoppingCart.removeItemFromCart(name);
                displayCart();
            });

            $("#show-cart").on("click", ".plus-item", function(event){
                var name = $(this).attr("data-name");
                shoppingCart.addItemToCart(name, 0, 1);
                displayCart();
            });

            $("#show-cart").on("change", ".item-count", function(event){
                var name = $(this).attr("data-name");
                var count = Number($(this).val());
                shoppingCart.setCountForItem(name, count);
                displayCart();
            });
            displayCart();
        </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="{% static '/coffee/js/bootstrap.min.js' %}"></script>
    </body>
</html>




